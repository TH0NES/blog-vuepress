```
import { Arguments } from 'yargs';

import { babelRegister } from '@cyber/utils';

import ConfigParser from '../../../config/parser';

import getWebpackConfig from '../../../webpack/getConfig';

import { resolve } from 'path';

import webpack from 'webpack';

import debug from 'debug';

import chalk from 'chalk';

import MiniCssExtractPlugin from 'mini-css-extract-plugin';

  

const log = debug('cyber:doc:build');

  

export default function (argv: Arguments) {

 const isDev = false;

 const cwd = process.cwd();

  

 // register babel typescript

 babelRegister([

 /\.cyber(\.(development|production))?\.[tj]s/,

 /mock/,

 /config/,

 ]);

  

 const configParser = new ConfigParser(cwd, isDev);

 const config = configParser.parse();

  

 const webpackConfig = getWebpackConfig({ isDev, cwd, ...config });

  

 webpackConfig.entryPoints.delete('cyber');

 webpackConfig.plugins.delete('html');

 webpackConfig.plugins.delete('html-tags');

 webpackConfig.plugins.delete('extract-css');

  

 const library = config.library || require(`${cwd}/package.json`).name;

  

 webpackConfig.entry(library).add('./src/index');

  

 webpackConfig.output

 .path(resolve(cwd, 'dist'))

 .filename('[name].js')

 .library('@cyber/ui')

 .libraryTarget('umd')

 .libraryExport('default')

 .umdNamedDefine(true)

  

 webpackConfig.plugin('extract-css').use(MiniCssExtractPlugin, [

 {

 filename: '[name].css',

 chunkFilename: '[name].css',

 },

 ]);

  

 const resolvedConfig = webpackConfig.toConfig();

 log('webpack config: %O', resolvedConfig);

  

 webpack(resolvedConfig, (err, stats) => {

 if (err) {

 console.log(err);

 process.exit(1);

 }

 if (stats?.hasErrors()) {

 console.log(stats.toString());

 process.exit(1);

 }

  

 console.log(`✨ ${chalk.green('构建成功')}`);

 });

}